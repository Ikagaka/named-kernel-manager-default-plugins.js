{"version":3,"sources":["lib/element_list.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;IAEa,W,WAAA,W,GACX,qBAAY,OAAZ,EAAsC;AAAA,MAAjB,QAAiB,yDAAN,IAAM;AAAA;;AACpC,OAAK,OAAL,GAAe,OAAf;AACA,OAAK,OAAL;AACA,OAAK,KAAL,GAAa,YAAY,KAAK,OAAL,CAAa,IAAb,CAAkB,IAAlB,CAAZ,EAAqC,QAArC,CAAb;AACA,OAAK,IAAL,GAAY,EAAZ;AACD,C;;IAGU,S,WAAA,S;;;;;;;;;;;;;;;;;AAEH,6B,GAAgB,KAAK,OAAL,CAAa,UAAb,CAAwB,a;;uBACzB,cAAc,MAAd,E;;;AAAf,sB;;uBACY,kBAAQ,GAAR,CAAY,OAAO,GAAP,CAAW,UAAC,OAAD;AAAA,yBAAa,cAAc,UAAd,CAAyB,OAAzB,EAAkC,IAAlC,CAAuC,UAAC,IAAD;AAAA,2BAAU,CAAC,IAAD,EAAO,OAAP,CAAV;AAAA,mBAAvC,CAAb;AAAA,iBAAX,CAAZ,C;;;AAAlB,qBAAK,I;;;;;;;;;;;;;;;;;;EAJsB,W;;IAQlB,W,WAAA,W;;;;;;;;;;;;;;;;;AAEH,6B,GAAgB,KAAK,OAAL,CAAa,UAAb,CAAwB,a;;uBACvB,cAAc,QAAd,E;;;AAAjB,wB;;uBACY,kBAAQ,GAAR,CAAY,SAAS,GAAT,CAAa,UAAC,OAAD;AAAA,yBAAa,cAAc,YAAd,CAA2B,OAA3B,EAAoC,IAApC,CAAyC,UAAC,IAAD;AAAA,2BAAU,CAAC,IAAD,EAAO,OAAP,CAAV;AAAA,mBAAzC,CAAb;AAAA,iBAAb,CAAZ,C;;;AAAlB,qBAAK,I;;;;;;;;;;;;;;;;;;EAJwB,W;;IAQpB,S,WAAA,S;;;AACX,qBAAY,OAAZ,EAAqB;AAAA;;AAAA,oHACb,OADa;;AAEnB,WAAK,IAAL,GAAY,EAAZ;AAFmB;AAGpB;;;;;;;;;;;;;AAGO,6B,GAAgB,KAAK,OAAL,CAAa,UAAb,CAAwB,a;;uBACzB,cAAc,MAAd,E;;;AAAf,sB;;uBACe,kBAAQ,GAAR,CAAY,OAAO,GAAP,CAAW,UAAC,OAAD;AAAA,yBAAa,OAAK,YAAL,CAAkB,OAAlB,CAAb;AAAA,iBAAX,CAAZ,C;;;AAAf,sB;AACA,oB,GAAO,E;;AACb,uBAAO,OAAP,CAAe,UAAC,CAAD,EAAI,KAAJ,EAAc;AAAE,yBAAK,IAAL,CAAU,OAAO,KAAP,CAAV,IAA2B,OAAO,KAAP,CAA3B;AAA0C,iBAAzE;AACA,qBAAK,IAAL,GAAY,IAAZ;;;;;;;;;;;;;;;;;;;+FAGiB,S;;;;;;AACX,6B,GAAgB,KAAK,OAAL,CAAa,UAAb,CAAwB,a;;uBACzB,cAAc,MAAd,CAAqB,SAArB,C;;;AAAf,sB;;uBACO,kBAAQ,GAAR,CAAY,OAAO,GAAP,CAAW,UAAC,OAAD;AAAA,yBAAa,cAAc,UAAd,CAAyB,SAAzB,EAAoC,OAApC,EAA6C,IAA7C,CAAkD,UAAC,IAAD;AAAA,2BAAU,CAAC,IAAD,EAAO,OAAP,CAAV;AAAA,mBAAlD,CAAb;AAAA,iBAAX,CAAZ,C;;;;;;;;;;;;;;;;;;;;;EAlBc,W;;IAsBlB,kB,WAAA,kB;;;;;;;0BACL,M,EAAQ;AACZ,aAAO,UAAP,CAAkB,uBAAlB,EAA2C,UAAC,MAAD,EAAY;AACrD,eAAO,IAAP,CAAY,oBAAZ,EAAkC,UAAC,MAAD,EAAY;AAC5C,iBAAO,KAAP,CAAa,OAAb;AACD,SAFD;AAGD,OAJD;AAKD;;;;;AAGH;;;IACa,qB,WAAA,qB;;;AACX,iCAAY,OAAZ,EAAqB;AAAA;AAAA,0HACb,OADa;AAEpB;;;;4BAEO;AACN,WAAK,OAAL,CAAa,iBAAb,CAA+B,WAA/B,EAA4C,IAAI,SAAJ,EAA5C;AACA,WAAK,OAAL,CAAa,iBAAb,CAA+B,aAA/B,EAA8C,IAAI,WAAJ,EAA9C;AACA,WAAK,OAAL,CAAa,iBAAb,CAA+B,WAA/B,EAA4C,IAAI,SAAJ,EAA5C;AACD;;;;;AAGH,kDAA8B,qBAA9B,GAAsD,qBAAtD;AACA,+CAA2B,IAA3B,CAAgC,kBAAhC","file":"element_list.js","sourcesContent":["import {NamedKernelManagerRoutings, NamedKernelManagerControllers, NamedKernelManagerController} from 'named-kernel-manager';\r\n\r\nexport class ElementList {\r\n  constructor(manager, interval = 1000) {\r\n    this.manager = manager;\r\n    this.getList();\r\n    this.timer = setInterval(this.getList.bind(this), interval);\r\n    this.list = [];\r\n  }\r\n}\r\n\r\nexport class GhostList extends ElementList {\r\n  async getList() {\r\n    const nanikaStorage = this.manager.components.NanikaStorage;\r\n    const ghosts = await nanikaStorage.ghosts();\r\n    this.list = await Promise.all(ghosts.map((dirpath) => nanikaStorage.ghost_name(dirpath).then((name) => [name, dirpath])));\r\n  }\r\n}\r\n\r\nexport class BalloonList extends ElementList {\r\n  async getList() {\r\n    const nanikaStorage = this.manager.components.NanikaStorage;\r\n    const balloons = await nanikaStorage.balloons();\r\n    this.list = await Promise.all(balloons.map((dirpath) => nanikaStorage.balloon_name(dirpath).then((name) => [name, dirpath])));\r\n  }\r\n}\r\n\r\nexport class ShellList extends ElementList {\r\n  constructor(manager) {\r\n    super(manager);\r\n    this.list = {};\r\n  }\r\n\r\n  async getList() {\r\n    const nanikaStorage = this.manager.components.NanikaStorage;\r\n    const ghosts = await nanikaStorage.ghosts();\r\n    const shells = await Promise.all(ghosts.map((dirpath) => this.getShellList(dirpath)));\r\n    const list = {};\r\n    ghosts.forEach((_, index) => { this.list[ghosts[index]] = shells[index] });\r\n    this.list = list;\r\n  }\r\n\r\n  async getShellList(ghostpath) {\r\n    const nanikaStorage = this.manager.components.NanikaStorage;\r\n    const shells = await nanikaStorage.shells(ghostpath);\r\n    return await Promise.all(shells.map((dirpath) => nanikaStorage.shell_name(ghostpath, dirpath).then((name) => [name, dirpath])));\r\n  }\r\n}\r\n\r\nexport class ElementListRouting {\r\n  setup(routes) {\r\n    routes.controller('ElementListController', (routes) => {\r\n      routes.from('NamedKernelManager', (routes) => {\r\n        routes.event('start');\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n// ゴースト等のリストをメニューから同期的に参照できるように\r\nexport class ElementListController extends NamedKernelManagerController {\r\n  constructor(manager) {\r\n    super(manager);\r\n  }\r\n\r\n  start() {\r\n    this.manager.registerComponent('GhostList', new GhostList());\r\n    this.manager.registerComponent('BalloonList', new BalloonList());\r\n    this.manager.registerComponent('ShellList', new ShellList());\r\n  }\r\n}\r\n\r\nNamedKernelManagerControllers.ElementListController = ElementListController;\r\nNamedKernelManagerRoutings.push(ElementListRouting);\r\n"]}